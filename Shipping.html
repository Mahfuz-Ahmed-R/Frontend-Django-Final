<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Delivery and Payment Page</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="stylesShipping.css" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <!-- Brand -->
        <a class="navbar-brand" href="index.html">
          <img
            src="https://via.placeholder.com/100x30?text=FOREVER."
            alt="Brand Logo"
            style="max-height: 30px"
          />
        </a>
        <!-- Navbar links -->
        <div class="collapse navbar-collapse justify-content-center">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="index.html">HOME</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="collections.html">COLLECTION</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">ABOUT</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">CONTACT</a>
            </li>
          </ul>
        </div>
        <!-- Icons and Search -->
        <div class="d-flex align-items-center">
          <button id="search-icon" class="btn btn-link p-0 me-3">
            <i class="fa-solid fa-search" style="font-size: 1.5rem"></i>
          </button>
          <div id="search-box" class="d-none">
            <input type="text" class="form-control" placeholder="Search" />
          </div>
          <div class="dropdown">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fa-solid fa-user" style="font-size: 1.5rem"></i>
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="profile.html">Profile</a></li>
              <li><a class="dropdown-item" href="myOrders.html">My Orders</a></li>
              <li><button class="dropdown-item" onclick="handleLogout()">Logout</button></li>
            </ul>
          </div>
          <button class="btn btn-link p-0">
            <a href="cart.html"><i class="fa-solid fa-cart-shopping" style="font-size: 1.5rem"></i></a>
            
          </button>
        </div>
      </div>
    </nav>
    <div class="container mt-5">
      <div class="row">
        <!-- Delivery Information -->
        <div class="col-md-6">
          <h5>DELIVERY INFORMATION</h5>
          <form id="deliveryForm">
            <div class="row mb-3">
              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  id="firstName"
                  placeholder="First name"
                  required
                />
              </div>
              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  id="lastName"
                  placeholder="Last name"
                  required
                />
              </div>
            </div>
            <div class="mb-3">
              <input
                type="email"
                class="form-control"
                id="email"
                placeholder="Email address"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="text"
                class="form-control"
                id="street"
                placeholder="Street"
                required
              />
            </div>
            <div class="row mb-3">
              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  id="city"
                  placeholder="City"
                  required
                />
              </div>
              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  id="state"
                  placeholder="State"
                  required
                />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  id="zipcode"
                  placeholder="Zipcode"
                  required
                />
              </div>
              <div class="col">
                <input
                  type="text"
                  class="form-control"
                  id="country"
                  placeholder="Country"
                  required
                />
              </div>
            </div>
          </form>
        </div>

        <!-- Cart Totals and Payment Method -->
        <div class="col-md-6">
          <!-- Cart Totals -->
          <div class="cart-totals mb-4" id="cart-totals">
            <!-- <h5>CART TOTALS</h5>
            <div class="totals-item d-flex justify-content-between">
              <span>Total Items</span>
              <span>x5</span>
            </div>
            <div class="totals-item d-flex justify-content-between">
              <span>Subtotal</span>
              <span id="subtotal">$294.00</span>
            </div>
            <div class="totals-item d-flex justify-content-between">
              <span>Shipping Fee</span>
              <span id="shippingFee">$10.00</span>
            </div>
            <div
              class="totals-item d-flex justify-content-between font-weight-bold"
            >
              <span>Total</span>
              <span id="total">$304.00</span>
            </div> -->
          </div>

          <!-- Payment Method -->
          <div class="payment-method mb-4">
            <h5>PAYMENT METHOD</h5>
            <div class="btn-group w-100" role="group">
              <input
                type="radio"
                class="btn-check"
                name="paymentMethod"
                id="stripe"
                autocomplete="off"
                value="Stripe"
              />
              <label class="btn btn-outline-primary" for="stripe">Stripe</label>

              <input
                type="radio"
                class="btn-check"
                name="paymentMethod"
                id="razorpay"
                autocomplete="off"
                value="Razorpay"
              />
              <label class="btn btn-outline-primary" for="razorpay"
                >Razorpay</label
              >

              <input
                type="radio"
                class="btn-check"
                name="paymentMethod"
                id="cod"
                autocomplete="off"
                value="COD"
                checked
              />
              <label class="btn btn-outline-primary" for="cod"
                >Cash on Delivery</label
              >
            </div>
          </div>
          <button class="btn btn-dark w-100" id="placeOrderBtn" onclick="get_shipping(event)">
            PLACE ORDER
          </button>
        </div>
      </div>
    </div>
    <footer class="footer mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-6 col-lg-6 footer-section">
            <div class="footer-logo">FOREVER<span>.</span></div>
            <p class="footer-text" style="width: 80%">
              Lorem ipsum is simply dummy text of the printing and typesetting
              industry. Lorem Ipsum has been the industry's standard dummy text
              ever since the 1500s, when an unknown printer took a galley of
              type and scrambled it to make a type specimen book.
            </p>
          </div>
          <div class="col-md-6 col-lg-3 footer-section">
            <h4>COMPANY</h4>
            <ul class="footer-links">
              <li><a href="index.html">Home</a></li>
              <li><a href="about.html">About us</a></li>
              <li><a href="contact.html">Contact</a></li>
              <li><a href="privacy.html">Privacy policy</a></li>
            </ul>
          </div>
          <div class="col-md-6 col-lg-3 footer-section">
            <h4>GET IN TOUCH</h4>
            <div class="footer-contact">
              <p>+1-212-456-7890</p>
              <p>contact@foreveryou.com</p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script src="scripts.js"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const order_id = urlParams.get("id");
      let total_amount = 0;
      let customer_order;
      fetch(`http://127.0.0.1:8000/order/${order_id}/`)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        order_cart(data);  // Call the function to update the cart totals
        console.log(data); // Log the customer order ID
      })
      .catch((error) => {
        console.error("There was a problem with the fetch operation:", error);
      });

      const order_cart = (order) => {
        const parent = document.getElementById("cart-totals");
        total_amount = order.cart_total;
        customer_order = order.id;
        parent.innerHTML = `
    <h5>CART TOTALS</h5>
    <div class="totals-item d-flex justify-content-between">
      <span>Total Items</span>
      <span>x${order.cart_item}</span>
    </div>
    <div class="totals-item d-flex justify-content-between">
      <span>Subtotal</span>
      <span>৳${order.cart_total}</span>
    </div>
    <div class="totals-item d-flex justify-content-between">
      <span>Shipping Fee</span>
      <span>৳60.00</span>
    </div>
    <div class="totals-item d-flex justify-content-between font-weight-bold">
      <span>Total</span>
      <span>৳${order.cart_total + 60.0}</span>
    </div>
  `;
      };

    function get_shipping(event){
      event.preventDefault();
      const name = document.getElementById('firstName').value;
      const email = document.getElementById('email').value;
      const street = document.getElementById('street').value;
      const city = document.getElementById('city').value;
      const state = document.getElementById('state').value;
      const zipcode = document.getElementById('zipcode').value;
      const country = document.getElementById('country').value;
      const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
      const total_amountt= (total_amount+60.00);
      const order = customer_order;
      const user = localStorage.getItem('user_id');

      const data = {
        order : order,
        user: parseInt(user),
        name: name,
        email: email,
        street: street,
        city: city,
        state: state,
        zipcode: zipcode,
        country: country,
        payment: paymentMethod,
        amount:total_amountt
      };
      console.log(data);

      fetch('http://127.0.0.1:8000/shipping-address/',{
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
      })
    }
    </script>
  </body>
</html>
