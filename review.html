<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Review</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
  />
  <link rel="stylesheet" href="styleReview.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <!-- Brand -->
      <a class="navbar-brand" href="index.html">
        <img
          src="https://via.placeholder.com/100x30?text=FOREVER."
          alt="Brand Logo"
          style="max-height: 30px"
        />
      </a>
      <!-- Navbar links -->
      <div class="collapse navbar-collapse justify-content-center">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="index.html">HOME</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="collections.html">COLLECTION</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">ABOUT</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contact.html">CONTACT</a>
          </li>
          <li class="nav-item" id="auth-links">
            <a href="login.html">Login</a>/<a href="register.html">Register</a>
          </li>
        </ul>
      </div>
      <!-- Icons and Search -->
      <div class="d-flex align-items-center">
        <div class="dropdown" id="dropdown-box">
          <button
            class="btn btn-secondary dropdown-toggle"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="fa-solid fa-user" style="font-size: 1.5rem"></i>
          </button>
          <ul class="dropdown-menu">
            <li id="profile-link">
              <a class="dropdown-item" href="profile.html">Profile</a>
            </li>
            <li id="orders-link">
              <a class="dropdown-item" href="myOrders.html">My Orders</a>
            </li>
            <li id="wishlist-link">
              <a class="dropdown-item" href="wishList.html">WishList</a>
            </li>
            <li id="logout-link">
              <button class="dropdown-item" onclick="handleLogout()">Logout</button>
            </li>
          </ul>
        </div>
        <button class="btn btn-link p-0">
          <a href="cart.html"
            ><i
              class="fa-solid fa-cart-shopping"
              style="font-size: 1.5rem"
            ></i
          ></a>
        </button>
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="review-container">
          <h2 class="text-center mb-4">Write a Review</h2>
          <div class="product-info" id="p-info">
            <img
              src="https://via.placeholder.com/100"
              alt="Product Image"
              class="product-image"
            />
            <div>
              <h3 class="product-name">Product Name</h3>
              <p>Brief product description goes here.</p>
            </div>
          </div>
          <form id="review-form" class="review-form">
            <div class="mb-3">
              <label for="rating" class="form-label">Your Rating</label>
              <div class="star-rating" id="star-rating">
                <i class="far fa-star" data-rating="1"></i>
                <i class="far fa-star" data-rating="2"></i>
                <i class="far fa-star" data-rating="3"></i>
                <i class="far fa-star" data-rating="4"></i>
                <i class="far fa-star" data-rating="5"></i>
              </div>
              <input
                type="hidden"
                name="rating"
                id="selected-rating"
                value="0"
              />
            </div>
            <div class="mb-3">
              <label for="review-text" class="form-label">Your Review</label>
              <textarea
                class="form-control"
                id="review-text"
                rows="5"
                placeholder="Write your review here"
              ></textarea>
            </div>
            <div class="mb-3">
              <label for="reviewer-name" class="form-label">Your Name</label>
              <input
                type="text"
                class="form-control"
                id="reviewer-name"
                placeholder="Enter your name"
              />
            </div>
            <div class="mb-3">
              <label for="reviewer-email" class="form-label">Your Email</label>
              <input
                type="email"
                class="form-control"
                id="reviewer-email"
                placeholder="Enter your email"
              />
            </div>
            <button
              type="submit"
              class="btn btn-submit-review"
            >
              Submit Review
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-lg-6 footer-section">
          <div class="footer-logo">FOREVER<span>.</span></div>
          <p class="footer-text" style="width: 80%">
            At FOREVER, we believe that style should never fade, which is why we offer timeless fashion that remains as captivating as ever. Our collection embodies "Style That Stays Forever", blending classic looks with contemporary trends to ensure you always find "Timeless Fashion, Forever Yours". Each piece is crafted to provide "Enduring Elegance, Forever in Style", making sure that every garment reflects "Forever Chic, Forever Unique". At FOREVER, we celebrate the beauty of "Classic Looks, Forever Trends" and strive to offer "Forever Fashioned for You". With "Ageless Apparel, Forever Fresh", our aim is to keep you looking "Forever Fabulous, Always in Vogue". Discover a place "Where Fashion Lasts Forever" and be inspired by our promise of "Forever Inspired, Forever Fashionable".
          </p>
        </div>
        <div class="col-md-6 col-lg-3 footer-section">
          <h4>COMPANY</h4>
          <ul class="footer-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About us</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="privacy.html">Privacy policy</a></li>
          </ul>
        </div>
        <div class="col-md-6 col-lg-3 footer-section">
          <h4>GET IN TOUCH</h4>
          <div class="footer-contact">
            <p>+1-212-456-7890</p>
            <p>contact@foreveryou.com</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css"></script>
  <script src="scripts.js"></script>
  <script src="auth.js"></script>
  <script>
    // Get the URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    // Fetch product details by ID
    fetch(`https://django-final-n0lr.onrender.com/product/${id}`)
      .then((response) => {
        if (!response.ok) {
          throw new Error(
            "Network response was not ok " + response.statusText
          );
        }
        return response.json();
      })
      .then((data) => {
        details(data);
        console.log(data);
      })
      .catch((error) => {
        console.error("There was a problem with the fetch operation:", error);
      });

    // Function to handle the product details
    function details(data) {
      const productInfo = document.getElementById("p-info");
      productInfo.innerHTML = `
        <img src="${data.image_1}" alt="Product Image" class="product-image">
        <div>
          <h3 class="product-name"><span id="reviewer-product">${data.id}</span> ${data.name}</h3>
        </div>
      `;
    }

    document.addEventListener("DOMContentLoaded", function () {
      const starRating = document.getElementById("star-rating");
      const selectedRating = document.getElementById("selected-rating");

      starRating.addEventListener("click", function (e) {
        if (e.target.matches(".fa-star")) {
          const rating = e.target.getAttribute("data-rating");
          selectedRating.value = rating;
          updateStars(rating);
        }
      });

      function updateStars(rating) {
        const stars = starRating.querySelectorAll(".fa-star");
        stars.forEach((star, index) => {
          if (index < rating) {
            star.classList.remove("far");
            star.classList.add("fas");
          } else {
            star.classList.remove("fas");
            star.classList.add("far");
          }
        });
      }
    });

    const handleReview = (e) => {
      e.preventDefault();
      const rating = document.getElementById("selected-rating").value;
      const review = document.getElementById("review-text").value;
      const customer = document.getElementById("reviewer-name").value;
      const product = document.getElementById("reviewer-product").textContent;
      const user = localStorage.getItem("user_id");
      const csrftoken = getCookie('csrftoken'); // Function to get CSRF token

      const data = {
        rating: rating,
        review: review,
        user: user,
        product: product,
      };

      fetch("https://django-final-n0lr.onrender.com/review/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken, // Include CSRF token if needed
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Success:", data);
          alert('Review Done');
        })
        .catch((error) => {
          console.error("Error:", error);
          alert('Error');
        });
    };

    // Attach the handleReview function to the form submission
    document.getElementById("review-form").addEventListener("submit", handleReview);

    // Function to get CSRF token from cookies
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
</body>
</html>
